<!DOCTYPE html>
<html>
<head>
	<title>Page Title</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="jquery.mobile-1.4.5.min.css">
	<link rel="stylesheet" href="dark.min.css">
	<script src="jquery.min.js"></script>
	<!--<script src="demos/_assets/js/index.js"></script>-->
	<script src="jquery.mobile-1.4.5.min.js"></script>
	
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.js"></script>
	<script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
	<script>
	  // Initialize Firebase
	  var config = {
		apiKey: "AIzaSyBLeRUwjrRDXdVyqdXK9SBQ7jR2ZziGP8w",
		authDomain: "ceci-vertretungsplan.firebaseapp.com",
		databaseURL: "https://ceci-vertretungsplan.firebaseio.com",
		storageBucket: "ceci-vertretungsplan.appspot.com",
	  };
	  firebase.initializeApp(config);
	  var rootRef = firebase.database().ref();
	  
	  
	</script>
</head>
<body>

<div data-role="page">

	<div data-role="header">
		<h1>Page Title</h1>
		<a href="#leftpanel1" class="ui-btn ui-shadow ui-corner-all ui-btn-inline ui-btn-mini">Overlay</a>
	</div><!-- /header -->

	<div role="main" class="ui-content">
		<div id="conTable">
			<table id="table"></table>
		</div>
		
		<div id="conAcc">
			<input type="text" id="uName" placeholder="Benutzername"></input>
			<input type="text" id="pwd"placeholder="Passwort"></input>
			<button id="subBtn" onclick="signIn(); setStorage()">Login</button>
		</div>
		
	</div><!-- /content -->

	<div data-role="footer" data-position="fixed">
		<div data-role="navbar">
			<ul>
				<li><a onclick="signIn('ef')" class="ui-btn-active">EF</a></li>
				<li><a onclick="signIn('q1')">Q1</a></li>
				<li><a onclick="signIn('q2')">Q2</a></li>
			</ul>
		</div><!-- /navbar -->
	</div>
	
	<!-- leftpanel1  -->
	<div data-role="panel" id="leftpanel1" data-position="left" data-display="overlay" data-theme="a">

        <h3>Vertretungsplan</h3>
        <ul>
			<li><a href="#">Vertretungsplan</a></li>
			<li><a onclick="loginForm()">Account</a></li>
			<li><a href="#">Info</a></li>
        <a href="#demo-links" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-btn-a ui-icon-delete ui-btn-icon-left ui-btn-inline">Close panel</a>

	</div><!-- /leftpanel1 -->
	
</div><!-- /page -->

<script type="text/javascript">
	function signIn(jahrgang){
	
		document.getElementById("conAcc").style.display="none";
	
	//firebase.auth().signOut();
		
		var email= document.getElementById('uName').value + "@example.com";
        var pwd = document.getElementById('pwd').value;
		
		if(email==null||pwd==null||email=="@example.com"||pwd==""){
			email= localStorage.getItem("email");
			pwd= localStorage.getItem("pwd");
			
			document.getElementById('uName').value=email;
			document.getElementById('pwd').value=pwd;
		}
		
		
		firebase.auth().signInWithEmailAndPassword(email, pwd).catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          // [START_EXCLUDE]
          if (errorCode === 'auth/wrong-password') {
            alert('Wrong password.');
          } else {
            console.error(error);
          }
          // [END_EXCLUDE]
        });
		
		var auth = firebase.auth();

		auth.onAuthStateChanged(function(user) {
		  if (user) {
			//alert('Geht');
			var uid = user.uid;
			
			if(user){
				uid = user.uid;
			}
			
			firebase.database().ref('users/' + uid + '/').on('value', function(snapshot) {
			var data = snapshot.val();
				
				var myTable = "";
				switch(jahrgang){
					case "ef":
						var stufe = data.EF;
						break;
					case "q1":
						var stufe = data.Q1;
						break;
					case "q2":
						var stufe = data.Q2;
						break;
				}
				
				var datum = "99.99";
				for(var i=1;i<=stufe.length-1; i++){
					var obj = stufe[i];
					if(datum != obj.Datum){
						myTable+= "<tr><td colspan='3' id='date'>"+obj.Tag+"</td>";
						myTable+= "<td colspan='2' id='date'>"+obj.Datum+"</td></tr>";
						
						myTable+= "<tr><td>"+obj.Fach+"</td>";
						myTable+= "<td>"+obj.Stunde+"</td>";
						myTable+= "<td>"+obj.Vertreter+"</td>";
						myTable+= "<td>"+obj.Raum+"</td>";
						if(isNaN(obj['Vertretungs-Text']) || obj['Vertretungs-Text'] == " " || obj['Vertretungs-Text'] == "&nbsp"){
							myTable+= "<td>"+obj['Vertretungs-Text']+"</td></tr>";
						}else{
							myTable+= "<td>&nbsp</td></tr>";
						}
					}
					else{
						myTable+= "<tr><td>"+obj.Fach+"</td>";
						myTable+= "<td>"+obj.Stunde+"</td>";
						myTable+= "<td>"+obj.Vertreter+"</td>";
						myTable+= "<td>"+obj.Raum+"</td>";
						if(isNaN(obj['Vertretungs-Text']) || obj['Vertretungs-Text'] == " " || obj['Vertretungs-Text'] == "&nbsp"){
							myTable+= "<td>"+obj['Vertretungs-Text']+"</td></tr>";
						}else{
							myTable+= "<td>&nbsp</td></tr>";
						}
					}
					datum = obj.Datum;
				}
				document.getElementById("table").innerHTML = myTable;
			});
			
		  } else {
			// User logged out
		  }
		});
		
		
	}
	
	function loginForm(){
		document.getElementById("conAcc").style.display="block";	
		document.getElementById("table").style.display="none";
	}
	
	function setStorage(){
		localStorage.setItem("email", document.getElementById('uName').value + "@example.com");
		localStorage.setItem("pwd", document.getElementById('pwd').value);
	}
	
	$(document).ready(function(){
		signIn("ef");
		});
	</script>

</body>
</html>